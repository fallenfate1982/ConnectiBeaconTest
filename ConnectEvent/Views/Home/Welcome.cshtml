@{
    Layout = "~/Views/Shared/_WelcomeLayoutPage.cshtml";
}


<div id="noNamesDiv">
    Welcome to <br /> Aura-Tech Solutions Ltd.'s <br /> Connect Event 2015!
    <br /><br />
    <div style="font-size:20pt;">Please see the attendants at the door to help you get signed in and on wifi!</div>
    <div>
        <img src="~/Content/images/Reach.png" style="max-width:100px; margin-right:140px;" />
        <img src="~/Content/images/ATSL.png" style="max-height:90px; margin-right:140px;" />
        <img src="~/Content/images/Connect.png" style="max-height:100px;" />
    </div>
</div>
<div id="namesDiv" style="visibility:hidden;">
    Thanks for joining us!
    <ul id="discussion"></ul>
</div>



@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
            var idMarker = 1;
            var currentCount = 0;
            var currentDiv = "noName";
            $(function () {
                // Reference the auto-generated proxy for the hub.
                var chat = $.connection.chatHub;
                // Create a function that the hub can call back to display messages.
                chat.client.addNewMessageToPage = function (message) {
                    showPerson(message);
                };
                // Start the connection.
                $.connection.hub.start().done(function () {
                });
            });
            // This optional function html-encodes messages for display in the page.
            function htmlEncode(value) {
                //split the string into parts
                var parts = value.split(",");

                var htmlChunk = "<div style='line-height:48px; margin-top:35px;'><span>" + parts[0] + " " + parts[1] + "</span><br/><span style=font-size:30pt;>" + parts[2] + "</span></div>";
                return htmlChunk;
            }

            function showDefaultDiv() {
                $("#namesDiv").removeClass('animated bounceInUp');
                $("#namesDiv").addClass('animated bounceOutUp');
                $('#namesDiv').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',
                    function ()
                    {
                        //just make sure no background stuff is happening
                        if (currentDiv == "noName")
                        {
                            $("#namesDiv").css('visibility', 'hidden');

                            $("#noNamesDiv").removeClass('animated bounceOutUp');
                            $("#noNamesDiv").addClass('animated bounceInUp');
                            $("#noNamesDiv").css('visibility', 'visible');
                            currentCount = 0;
                        }

                    });

            }

            function showNamesDiv() {
                $("#noNamesDiv").removeClass('animated bounceInUp');
                $("#noNamesDiv").addClass('animated bounceOutUp');
                $('#noNamesDiv').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',
                    function () {
                        //just make sure no background stuff is happening
                        if (currentDiv == "name") {
                            $("#noNamesDiv").css('visibility', 'hidden');

                            $("#namesDiv").removeClass('animated bounceOutUp');
                            $("#namesDiv").addClass('animated bounceInUp');
                            $("#namesDiv").css('visibility', 'visible');
                        }
                    });


            }

            function showPerson(message) {
                if (currentCount <= 0)
                {
                    //need to swap divs
                    currentDiv = "name";
                    showNamesDiv();
                }

                // Add the message to the page.
                $('#discussion').append("<li id='name" + idMarker + "'>" + htmlEncode(message) + "</li>");
                $("#name" + idMarker).addClass('animated bounceInRight');

                currentCount++;
                idMarker++;

                //wait for animation to finish before removing classes
                setTimeout(function () {
                    if ($('ul li:first').length == 1)
                    {
                        $('ul li:first').removeClass('animated bounceInRight');
                        $('ul li:first').addClass('animated bounceOutLeft');
                        $('ul li:first').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',
                            function () {
                                $('ul li:first').remove();
                                currentCount--;
                                if (currentCount <= 0) {
                                    currentDiv = "noName";
                                    showDefaultDiv();
                                }
                            });
                    }

                }, 20000);
            }

    </script>
}

